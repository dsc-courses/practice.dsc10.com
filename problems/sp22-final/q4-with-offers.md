# BEGIN PROB

Recall that we have the complete set of currently available discounts in the DataFrame `offers`. 

The DataFrame `with_offers` is created as follows.

```py
    (with_offers = ikea.take(np.arange(6))
                       .merge(offers, left_on='category',  
                                      right_on='eligible_category'))
```

# BEGIN SUBPROB

How many rows does `with_offers` have?

# BEGIN SOLUTION

**Answer: ** 11

First, consider the DataFrame `ikea.take(np.arange(6))`, which contains the first six rows of `ikea`. We know the contents of these first six rows from the preview of the DataFrame at the start of this exam. To merge with `offers`, we need to look at the `'category'` of each of these six rows and see how many rows of `offers` have the same value in the `'eligible_category'` column. 

The first row of `ikea.take(np.arange(6))` is a `'bed'`. There are two `'bed'` offers, so that will create two rows in the output DataFrame. Similarly, the second row of `ikea.take(np.arange(6))` creates two rows in the output DataFrame because there are two `'outdoor'` offers. The third row creates just one row in the output, since there is only one `'dresser'` offer. Continuing row-by-row in this way, we can sum the number of rows created to get:
$$2+2+1+2+2+2 = 11.$$

Pandas Tutor is a really helpful tool to visualize the merge process. Below is a color-coded visualization of this merge, generated by the <a href="https://pandastutor.com/vis.html#code=import%20pandas%20as%20pd%0Aimport%20numpy%20as%20np%0Aimport%20io%0A%0Aikea%20%3D%20pd.DataFrame%28%29.assign%28product%3D%5B%22%C3%84PPLAR%C3%96%20Table%2B6%20armchairs,%20outdoor,%20brown%20stained%22,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22SUNDS%C3%96%20Table%2B2%20chairs,%20outdoor,%20gray/gray%22,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22GLADSTAD%20Upholstered%20bed,%202%20storage%20boxes,%20Kabusa%20light%20gray,%20Twin%22,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22HEMNES%20Daybed%20frame%20with%203%20drawers,%20white,%20Twin%22,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22HEMNES%206-drawer%20chest,%20white%20stain,%2042%201/2x51%205/8%22,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22LAPPLAND%20TV%20storage%20unit,%20white,%2072x15%203/8x57%207/8%22%5D,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20category%3D%5B%22outdoor%22,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22outdoor%22,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22bed%22,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22bed%22,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22dresser%22,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22storage%22%5D,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20price%3D%5B629,%20149,%20254,%20399,%20299,%20179%5D,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20assembly_cost%3D%5B62,%2035,%2098,%2075,%2065,%2056%5D,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20packages%3D%5B7,%203,%201,%201,%201,%201%5D%29.take%28%5B2,%200,%204,%205,%201,%203%5D%29.reset_index%28%29.drop%28columns%3D%22index%22%29%0Aoffers%20%3D%20pd.DataFrame%28%29.assign%28offer%3D%5B%22summer%20sale%22,%20%22summer%20sale%22,%20%22get%20organized%20promo%22,%20%22get%20organized%20promo%22,%20%22snooze%20sale%22,%20%22birthday%20coupon%22,%20%22birthday%20coupon%22,%20%22birthday%20coupon%22%5D,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20eligible_category%20%3D%20%5B%22outdoor%22,%20%22grill%22,%20%22storage%22,%20%22dresser%22,%20%22bed%22,%20%22outdoor%22,%20%22storage%22,%20%22bed%22%5D,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20percent_off%3D%5B15,%2015,%2010,%2010,%2020,%2015,%2015,%2015%5D%29%0Aikea.take%28np.arange%286%29%29.merge%28offers,%20left_on%3D'category',%20right_on%3D'eligible_category'%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%0A&d=2022-07-27&lang=py&v=v1">code here</a>.

<center><img src='../assets/images/sp22-final/mergetutor.jpg' width=80%></center>

<average>41</average>
# END SOLUTION

# END SUBPROB

# BEGIN SUBPROB

How many rows of `with_offers` have a value of 20 in the `'percent_off'` column?

# BEGIN SOLUTION

**Answer: ** 2

There is just one offer with a value of 20 in the `'percent_off'` column, and this corresponds to an offer on a `'bed'`. Since there are two rows of  `ikea.take(np.arange(6))` with a `'category'` of `'bed'`, each of these will match with the 20 percent-off offer, creating two rows of `with_offers` with a value of 20 in the `'percent_off'` column.

The <a href="https://pandastutor.com/vis.html#code=import%20pandas%20as%20pd%0Aimport%20numpy%20as%20np%0Aimport%20io%0A%0Aikea%20%3D%20pd.DataFrame%28%29.assign%28product%3D%5B%22%C3%84PPLAR%C3%96%20Table%2B6%20armchairs,%20outdoor,%20brown%20stained%22,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22SUNDS%C3%96%20Table%2B2%20chairs,%20outdoor,%20gray/gray%22,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22GLADSTAD%20Upholstered%20bed,%202%20storage%20boxes,%20Kabusa%20light%20gray,%20Twin%22,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22HEMNES%20Daybed%20frame%20with%203%20drawers,%20white,%20Twin%22,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22HEMNES%206-drawer%20chest,%20white%20stain,%2042%201/2x51%205/8%22,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22LAPPLAND%20TV%20storage%20unit,%20white,%2072x15%203/8x57%207/8%22%5D,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20category%3D%5B%22outdoor%22,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22outdoor%22,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22bed%22,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22bed%22,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22dresser%22,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22storage%22%5D,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20price%3D%5B629,%20149,%20254,%20399,%20299,%20179%5D,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20assembly_cost%3D%5B62,%2035,%2098,%2075,%2065,%2056%5D,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20packages%3D%5B7,%203,%201,%201,%201,%201%5D%29.take%28%5B2,%200,%204,%205,%201,%203%5D%29.reset_index%28%29.drop%28columns%3D%22index%22%29%0Aoffers%20%3D%20pd.DataFrame%28%29.assign%28offer%3D%5B%22summer%20sale%22,%20%22summer%20sale%22,%20%22get%20organized%20promo%22,%20%22get%20organized%20promo%22,%20%22snooze%20sale%22,%20%22birthday%20coupon%22,%20%22birthday%20coupon%22,%20%22birthday%20coupon%22%5D,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20eligible_category%20%3D%20%5B%22outdoor%22,%20%22grill%22,%20%22storage%22,%20%22dresser%22,%20%22bed%22,%20%22outdoor%22,%20%22storage%22,%20%22bed%22%5D,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20percent_off%3D%5B15,%2015,%2010,%2010,%2020,%2015,%2015,%2015%5D%29%0Aikea.take%28np.arange%286%29%29.merge%28offers,%20left_on%3D'category',%20right_on%3D'eligible_category'%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%0A&d=2022-07-27&lang=py&v=v1">visualization from Pandas Tutor</a>
 below confirms our answer. The two rows with a value of 20 in the `'percent_off'` column are both shown in rows 0 and 2 of the output DataFrame.

<center><img src='../assets/images/sp22-final/mergetutor.jpg' width=80%></center>

<average>70</average>
# END SOLUTION

# END SUBPROB

# BEGIN SUBPROB

If you can use just one offer per product, you'd want to use the one that saves you the most money, which we'll call the best offer.

**True or False**: The expression below evaluates to a Series indexed by `'product'` with the name of the best offer for each product that appears in the `with_offers` DataFrame. 

```py
with_offers.groupby('product').max().get('offer')
```

( ) True
( ) False


# BEGIN SOLUTION

**Answer: ** False

Recall that `groupby` applies the aggregation function separately to each column. Applying the `.max()` aggregate on the `'offer'` column for each group gives the name that is latest in alphabetical order because it contains strings, whereas applying the `.max()` aggregate on the `'percent_off'` column gives the largest numerical value. These don't necessarily go together in `with_offers`. 

In particular, the element of `with_offers.groupby('product').max().get('offer')` corresponding to the LAPPLAND TV storage unit will be  `'get_organized_promo'`. This happens because the two rows of `with_offers` corresponding to the LAPPLAND TV storage unit have values of `'get_organized_promo'` and `'birthday coupon'`, but `'get_organized_promo'` is alphabetically later, so it's considered the max by `.groupby`. However, the `'birthday coupon'` is actually a better offer, since it's 15 percent off, while the `'get_organized_promo'` is only 10 percent off. The expression does not actually find the best offer for each product, but instead finds the latest alphabetical offer for each product.

We can see this directly by looking at the output of Pandas Tutor below, generated by <a href="https://pandastutor.com/vis.html#code=import%20pandas%20as%20pd%0Aimport%20numpy%20as%20np%0Aimport%20io%0A%0Aikea%20%3D%20pd.DataFrame%28%29.assign%28product%3D%5B%22%C3%84PPLAR%C3%96%20Table%2B6%20armchairs,%20outdoor,%20brown%20stained%22,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22SUNDS%C3%96%20Table%2B2%20chairs,%20outdoor,%20gray/gray%22,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22GLADSTAD%20Upholstered%20bed,%202%20storage%20boxes,%20Kabusa%20light%20gray,%20Twin%22,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22HEMNES%20Daybed%20frame%20with%203%20drawers,%20white,%20Twin%22,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22HEMNES%206-drawer%20chest,%20white%20stain,%2042%201/2x51%205/8%22,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22LAPPLAND%20TV%20storage%20unit,%20white,%2072x15%203/8x57%207/8%22%5D,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20category%3D%5B%22outdoor%22,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22outdoor%22,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22bed%22,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22bed%22,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22dresser%22,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22storage%22%5D,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20price%3D%5B629,%20149,%20254,%20399,%20299,%20179%5D,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20assembly_cost%3D%5B62,%2035,%2098,%2075,%2065,%2056%5D,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20packages%3D%5B7,%203,%201,%201,%201,%201%5D%29.take%28%5B2,%200,%204,%205,%201,%203%5D%29.reset_index%28%29.drop%28columns%3D%22index%22%29%0Aoffers%20%3D%20pd.DataFrame%28%29.assign%28offer%3D%5B%22summer%20sale%22,%20%22summer%20sale%22,%20%22get%20organized%20promo%22,%20%22get%20organized%20promo%22,%20%22snooze%20sale%22,%20%22birthday%20coupon%22,%20%22birthday%20coupon%22,%20%22birthday%20coupon%22%5D,%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20eligible_category%20%3D%20%5B%22outdoor%22,%20%22grill%22,%20%22storage%22,%20%22dresser%22,%20%22bed%22,%20%22outdoor%22,%20%22storage%22,%20%22bed%22%5D,%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20percent_off%3D%5B15,%2015,%2010,%2010,%2020,%2015,%2015,%2015%5D%29%0Awith_offers%20%3D%20ikea.take%28np.arange%286%29%29.merge%28offers,%20left_on%3D'category',%20right_on%3D'eligible_category'%29%0Awith_offers.groupby%28'product'%29.max%28%29.get%28'offer'%29%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%0A&d=2022-07-27&lang=py&v=v1">this code</a>. 

<center><img src='../assets/images/sp22-final/maxtutor.jpg' width=80%></center>

<average>69</average>
# END SOLUTION

# END SUBPROB

# BEGIN SUBPROB

You want to add a column to `with_offers` containing the price after the offer discount is applied. 

```py
with_offers = with_offers.assign(after_price = _________)
with_offers
```

Which of the following could go in the blank? Select all that apply.

[ ] `with_offers.get('price') - with_offers.get('percent_off')/100`
[ ] `with_offers.get('price')*(100 - with_offers.get('percent_off'))/100`
[ ] `with_offers.get('price') - with_offers.get('price')*with_offers.get('percent_off')/100`
[ ] `with_offers.get('price')*(100 - with_offers.get('percent_off')/100)`

# BEGIN SOLUTION

**Answer: ** `with_offers.get('price')*(100 - with_offers.get('percent_off'))/100`,
`(with_offers.get('price') - with_offers.get('price')*with_offers.get('percent_off')/100)`

Notice that all the answer choices use `with_offers.get('price')`, which is a Series of prices, and `with_offers.get('percent_off')`, which is a Series of associated percentages off. Using Series arithmetic, which works element-wise, the goal is to create a Series of prices after the discount is applied. 

For example, the first row of `with_offers` corresponds to an item with a price of 254 dollars, and a discount of 20 percent off, coming from the snooze sale. This means its price after the discount should be 80 percent of the original value, which is $254*0.8 = 203.2$ dollars.

Let's go through each answer in order, working with this example. 

The first answer choice takes the price and subtracts the percent off divided by 100. For our example, this would compute the discounted price as $254 - 20/100 = 253.8$ dollars, which is incorrect.

The second answer choice multiplies the price by the quantity 100 minus the percent off, then divides by 100. This works because when we subtract the percent off from 100 and divide by 100, the result represents the proportion or fraction of the cost we must pay, and so multiplying by the price gives the price after the discount. For our example, this comes out to $254*(100-20)/100= 203.2$ dollars, which is correct.

The third answer choice is also correct. This corresponds to taking the original price and subtracting from it the dollar amount off, which comes from multiplying the price by the percent off and dividing by 100. For our example, this would be computed as $254 - 254*20/100 = 203.2$ dollars, which is correct.

The fourth answer multiplies the price by the quantity 100 minus the percent off divided by 100. For our example, this would compute the discounted price as $254*(100 - 20/100) = 25349.2$ dollars, a number that's nearly one hundred times the original price! 

Therefore, only the second and third answer choices are correct.

<average>79</average>
# END SOLUTION

# END SUBPROB

# END PROB